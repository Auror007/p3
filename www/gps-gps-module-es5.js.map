{"version":3,"sources":["src/app/gps/gps.page.html","src/app/gps/gps.module.ts","src/app/gps/gps.page.scss","src/app/gps/gps.page.ts"],"names":[],"mappings":"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","sourcesContent":["export default \"<ion-header>\\n  <ion-toolbar >\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-back-button routerLink=\\\"/tabs/tabs/services\\\" routerDirection=\\\"backward\\\"></ion-back-button>\\n    </ion-buttons>\\n    <ion-title>\\n      Live Tracking\\n    </ion-title>\\n  </ion-toolbar>\\n</ion-header>\\n \\n<ion-content>\\n \\n  <div #map id=\\\"map\\\" [hidden]=\\\"!user\\\"></div>\\n  <ion-item class=\\\"align-items-center\\\">\\n    <ion-label  [hidden]=\\\"user\\\"><b>No cleaner assigned yet</b></ion-label>\\n\\n  </ion-item>\\n\\n  <div *ngIf=\\\"user\\\">\\n    <ion-item>\\n      \\n      <ion-label>User ID: {{ user }}</ion-label>\\n    </ion-item>\\n    <ion-item (click)=\\\"call()\\\">\\n      <ion-label>Contact: {{ phone }}</ion-label><ion-icon  name=\\\"call-sharp\\\"></ion-icon>\\n\\n    </ion-item>\\n \\n\\n \\n    <ion-list>\\n      <ion-item-sliding *ngFor=\\\"let pos of locations | async\\\">\\n        <ion-item>\\n          <ion-label text-wrap>\\n            Lat: {{ pos.lat }}\\n            Lng: {{ pos.lng }}\\n            <p>\\n              {{ pos.timestamp | date:'short' }}\\n            </p>\\n          </ion-label>\\n        </ion-item>\\n \\n        <ion-item-options side=\\\"start\\\">\\n          <ion-item-option color=\\\"danger\\\" (click)=\\\"deleteLocation(pos)\\\">\\n            <ion-icon name=\\\"trash\\\" slot=\\\"icon-only\\\"></ion-icon>\\n          </ion-item-option>\\n        </ion-item-options>\\n \\n      </ion-item-sliding>\\n    </ion-list>\\n \\n  </div>\\n \\n</ion-content>\\n\"","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { GpsPage } from './gps.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: GpsPage\n  }\n];\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    RouterModule.forChild(routes)\n  ],\n  declarations: [GpsPage]\n})\nexport class GpsPageModule {}\n","export default \"#map {\\n  width: 100%;\\n  height: 300px;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9hcHAvZ3BzL0Q6XFxTRU04XFxwMy9zcmNcXGFwcFxcZ3BzXFxncHMucGFnZS5zY3NzIiwic3JjL2FwcC9ncHMvZ3BzLnBhZ2Uuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQTtFQUNJLFdBQUE7RUFDQSxhQUFBO0FDQUoiLCJmaWxlIjoic3JjL2FwcC9ncHMvZ3BzLnBhZ2Uuc2NzcyIsInNvdXJjZXNDb250ZW50IjpbIlxyXG4jbWFwe1xyXG4gICAgd2lkdGg6MTAwJTtcclxuICAgIGhlaWdodDogMzAwcHg7XHJcbn0iLCIjbWFwIHtcbiAgd2lkdGg6IDEwMCU7XG4gIGhlaWdodDogMzAwcHg7XG59Il19 */\"","import { Component, ViewChild, ElementRef } from '@angular/core';\nimport {Plugins, GeolocationPluginWeb} from '@capacitor/core';\nimport { AngularFireAuth } from '@angular/fire/auth';\nimport { Observable } from 'rxjs';\nimport {map} from 'rxjs/operators';\nimport { AngularFirestoreCollection, AngularFirestore } from '@angular/fire/firestore';\nimport { HttpClient } from '@angular/common/http';\nimport {Storage} from '@ionic/storage';\n\nconst {Geolocation} =Plugins;\n\n declare var google;\n\n@Component({\n  selector: 'app-gps',\n  templateUrl: 'gps.page.html',\n  styleUrls: ['gps.page.scss'],\n})\nexport class GpsPage {\n  locations:Observable<any>;\n  locationsCollection: AngularFirestoreCollection<any>;\n  user=null;\n  public phone:number;\n  public email:string;\n  @ViewChild('map',{static:false}) mapElement:ElementRef;\n  map:any;\n  markers=[];\n  isTracking = false;\n  watch: string;\n  constructor(\n    private afAuth:AngularFireAuth,\n    private afs:AngularFirestore,\n    private http:HttpClient,\n    private storage:Storage\n    ) {\n      \n    this.anonLogin();\n  }\n\n  ionViewWillEnter(){\n    this.storage.get('email').then((res)=>{\n      this.email=res;\n      console.log(this.email);\n      \n      this.http.post<{data:{cleaner_name:string,cleaner_phone:number}}>('https://mywash.herokuapp.com/batch/track',{email:this.email}).subscribe((res)=>{\n        console.log(res);\n        if(res.data!=null)\n        {\n          \n        this.user=res.data.cleaner_name;\n        this.phone=res.data.cleaner_phone;\n        }\n        else{\n          console.log('null');\n         \n\n        }\n        \n      })\n      this.loadMap();\n    })\n    \n  }\n  loadMap(){\n    let latlng=new google.maps.LatLng(51.9090902,7,6673267);\n\n    let mapOptions={\n      center:latlng,\n      zoom:5,\n      mapTypeId:google.maps.MapTypeId.ROADMAP\n    };\n    this.map=new google.maps.Map(this.mapElement.nativeElement,mapOptions);\n  }\n  call() {\n    let tel_number = this.phone;\n    window.open(`tel:${tel_number}`, '_system')\n  }\n  anonLogin(){\n    //email auth\n    this.afAuth.auth.signInAnonymously().then(user=>{\n      console.log(user);\n      \n    }).then(()=>{\n      this.findloc();\n    });\n  }\n\n\n  findloc(){\n\n    console.log(\"loc called\");\n    \n      this.locationsCollection=this.afs.collection(\n        `locations/cleaner1/track`,\n        ref=>ref.orderBy('timestamp',\"desc\")\n      );\n      \n      this.locations = this.locationsCollection.snapshotChanges().pipe(\n        map(actions =>\n          actions.map(a => {\n            const data = a.payload.doc.data();\n            const id = a.payload.doc.id;\n            return { id, ...data };\n          })\n        )\n      );\n \n      this.locations.subscribe(locations => {\n        console.log(\"paused\",locations);\n\n        setTimeout(()=>{\n          console.log(\"update called\");\n    \n          this.markers.map(marker => marker.setMap(null));\n          this.markers = [];\n          // for (let loc of locations) {\n            let latLng = new google.maps.LatLng(locations[0].lat, locations[0].lng);\n            this.map.setCenter(latLng);\n            this.map.setZoom(14);\n            \n            let marker = new google.maps.Marker({\n              map: this.map,\n             // animation: google.maps.Animation.DROP,\n              position: latLng\n            });\n            this.markers.push(marker);\n        },2000);\n      });\n\n  }\n\n  // Delete a location from Firebase\n  deleteLocation(pos) {\n    this.locationsCollection.doc(pos.id).delete();\n\n  }\n   \n  // Redraw all markers on the map\n  // updateMap(locations) {\n  //   // Remove all current marker\n  //   console.log(\"update called\");\n    \n  //   this.markers.map(marker => marker.setMap(null));\n  //   this.markers = [];\n  //   // for (let loc of locations) {\n  //     let latLng = new google.maps.LatLng(locations[0].lat, locations[0].lng);\n  //     this.map.setCenter(latLng);\n  //     this.map.setZoom(14);\n      \n  //     let marker = new google.maps.Marker({\n  //       map: this.map,\n  //       animation: google.maps.Animation.DROP,\n  //       position: latLng\n  //     });\n  //     this.markers.push(marker);\n  //     this.findloc();\n  //     setTimeout(()=>{this.findloc();},10000);\n  //   // }\n  // }\n}\n"],"sourceRoot":"webpack:///","file":"gps-gps-module-es5.js"}