{"version":3,"sources":["./src/app/gps/gps.page.html","./src/app/gps/gps.module.ts","./src/app/gps/gps.page.scss","./src/app/gps/gps.page.ts"],"names":[],"mappings":"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","file":"gps-gps-module-es2015.js","sourcesContent":["export default \"<ion-header>\\n  <ion-toolbar >\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-back-button routerLink=\\\"/tabs/tabs/services\\\" routerDirection=\\\"backward\\\"></ion-back-button>\\n    </ion-buttons>\\n    <ion-title>\\n      Live Tracking\\n    </ion-title>\\n  </ion-toolbar>\\n</ion-header>\\n \\n<ion-content>\\n \\n  <div #map id=\\\"map\\\" [hidden]=\\\"!user\\\"></div>\\n  <ion-item class=\\\"align-items-center\\\">\\n    <ion-label  [hidden]=\\\"user\\\"><b>No cleaner assigned yet</b></ion-label>\\n\\n  </ion-item>\\n\\n  <div *ngIf=\\\"user\\\">\\n    <ion-item>\\n      \\n      <ion-label>User ID: {{ user }}</ion-label>\\n    </ion-item>\\n    <ion-item (click)=\\\"call()\\\">\\n      <ion-label>Contact: {{ phone }}</ion-label><ion-icon  name=\\\"call-sharp\\\"></ion-icon>\\n\\n    </ion-item>\\n \\n\\n \\n    <ion-list>\\n      <ion-item-sliding *ngFor=\\\"let pos of locations | async\\\">\\n        <ion-item>\\n          <ion-label text-wrap>\\n            Lat: {{ pos.lat }}\\n            Lng: {{ pos.lng }}\\n            <p>\\n              {{ pos.timestamp | date:'short' }}\\n            </p>\\n          </ion-label>\\n        </ion-item>\\n \\n        <ion-item-options side=\\\"start\\\">\\n          <ion-item-option color=\\\"danger\\\" (click)=\\\"deleteLocation(pos)\\\">\\n            <ion-icon name=\\\"trash\\\" slot=\\\"icon-only\\\"></ion-icon>\\n          </ion-item-option>\\n        </ion-item-options>\\n \\n      </ion-item-sliding>\\n    </ion-list>\\n \\n  </div>\\n \\n</ion-content>\\n\"","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { GpsPage } from './gps.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: GpsPage\n  }\n];\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    RouterModule.forChild(routes)\n  ],\n  declarations: [GpsPage]\n})\nexport class GpsPageModule {}\n","export default \"#map {\\n  width: 100%;\\n  height: 300px;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9hcHAvZ3BzL0Q6XFxTRU04XFxwMy9zcmNcXGFwcFxcZ3BzXFxncHMucGFnZS5zY3NzIiwic3JjL2FwcC9ncHMvZ3BzLnBhZ2Uuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQTtFQUNJLFdBQUE7RUFDQSxhQUFBO0FDQUoiLCJmaWxlIjoic3JjL2FwcC9ncHMvZ3BzLnBhZ2Uuc2NzcyIsInNvdXJjZXNDb250ZW50IjpbIlxyXG4jbWFwe1xyXG4gICAgd2lkdGg6MTAwJTtcclxuICAgIGhlaWdodDogMzAwcHg7XHJcbn0iLCIjbWFwIHtcbiAgd2lkdGg6IDEwMCU7XG4gIGhlaWdodDogMzAwcHg7XG59Il19 */\"","import { Component, ViewChild, ElementRef } from '@angular/core';\nimport {Plugins, GeolocationPluginWeb} from '@capacitor/core';\nimport { AngularFireAuth } from '@angular/fire/auth';\nimport { Observable } from 'rxjs';\nimport {map} from 'rxjs/operators';\nimport { AngularFirestoreCollection, AngularFirestore } from '@angular/fire/firestore';\nimport { HttpClient } from '@angular/common/http';\nimport {Storage} from '@ionic/storage';\n\nconst {Geolocation} =Plugins;\n\n declare var google;\n\n@Component({\n  selector: 'app-gps',\n  templateUrl: 'gps.page.html',\n  styleUrls: ['gps.page.scss'],\n})\nexport class GpsPage {\n  locations:Observable<any>;\n  locationsCollection: AngularFirestoreCollection<any>;\n  user=null;\n  public phone:number;\n  public email:string;\n  @ViewChild('map',{static:false}) mapElement:ElementRef;\n  map:any;\n  markers=[];\n  isTracking = false;\n  watch: string;\n  constructor(\n    private afAuth:AngularFireAuth,\n    private afs:AngularFirestore,\n    private http:HttpClient,\n    private storage:Storage\n    ) {\n      \n    this.anonLogin();\n  }\n\n  ionViewWillEnter(){\n    this.storage.get('email').then((res)=>{\n      this.email=res;\n      console.log(this.email);\n      \n      this.http.post<{data:{cleaner_name:string,cleaner_phone:number}}>('https://mywash.herokuapp.com/batch/track',{email:this.email}).subscribe((res)=>{\n        console.log(res);\n        if(res.data!=null)\n        {\n          \n        this.user=res.data.cleaner_name;\n        this.phone=res.data.cleaner_phone;\n        }\n        else{\n          console.log('null');\n         \n\n        }\n        \n      })\n      this.loadMap();\n    })\n    \n  }\n  loadMap(){\n    let latlng=new google.maps.LatLng(51.9090902,7,6673267);\n\n    let mapOptions={\n      center:latlng,\n      zoom:5,\n      mapTypeId:google.maps.MapTypeId.ROADMAP\n    };\n    this.map=new google.maps.Map(this.mapElement.nativeElement,mapOptions);\n  }\n  call() {\n    let tel_number = this.phone;\n    window.open(`tel:${tel_number}`, '_system')\n  }\n  anonLogin(){\n    //email auth\n    this.afAuth.auth.signInAnonymously().then(user=>{\n      console.log(user);\n      \n    }).then(()=>{\n      this.findloc();\n    });\n  }\n\n\n  findloc(){\n\n    console.log(\"loc called\");\n    \n      this.locationsCollection=this.afs.collection(\n        `locations/cleaner1/track`,\n        ref=>ref.orderBy('timestamp',\"desc\")\n      );\n      \n      this.locations = this.locationsCollection.snapshotChanges().pipe(\n        map(actions =>\n          actions.map(a => {\n            const data = a.payload.doc.data();\n            const id = a.payload.doc.id;\n            return { id, ...data };\n          })\n        )\n      );\n \n      this.locations.subscribe(locations => {\n        console.log(\"paused\",locations);\n\n        setTimeout(()=>{\n          console.log(\"update called\");\n    \n          this.markers.map(marker => marker.setMap(null));\n          this.markers = [];\n          // for (let loc of locations) {\n            let latLng = new google.maps.LatLng(locations[0].lat, locations[0].lng);\n            this.map.setCenter(latLng);\n            this.map.setZoom(14);\n            \n            let marker = new google.maps.Marker({\n              map: this.map,\n             // animation: google.maps.Animation.DROP,\n              position: latLng\n            });\n            this.markers.push(marker);\n        },2000);\n      });\n\n  }\n\n  // Delete a location from Firebase\n  deleteLocation(pos) {\n    this.locationsCollection.doc(pos.id).delete();\n\n  }\n   \n  // Redraw all markers on the map\n  // updateMap(locations) {\n  //   // Remove all current marker\n  //   console.log(\"update called\");\n    \n  //   this.markers.map(marker => marker.setMap(null));\n  //   this.markers = [];\n  //   // for (let loc of locations) {\n  //     let latLng = new google.maps.LatLng(locations[0].lat, locations[0].lng);\n  //     this.map.setCenter(latLng);\n  //     this.map.setZoom(14);\n      \n  //     let marker = new google.maps.Marker({\n  //       map: this.map,\n  //       animation: google.maps.Animation.DROP,\n  //       position: latLng\n  //     });\n  //     this.markers.push(marker);\n  //     this.findloc();\n  //     setTimeout(()=>{this.findloc();},10000);\n  //   // }\n  // }\n}\n"],"sourceRoot":"webpack:///"}