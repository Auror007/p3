{"version":3,"sources":["./src/app/gps/gps.page.html","./src/app/gps/gps.module.ts","./src/app/gps/gps.page.scss","./src/app/gps/gps.page.ts"],"names":[],"mappings":"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","file":"gps-gps-module-es2015.js","sourcesContent":["export default \"<ion-header>\\n  <ion-toolbar color=\\\"primary\\\">\\n    <ion-title>\\n      Live Tracking\\n    </ion-title>\\n  </ion-toolbar>\\n</ion-header>\\n \\n<ion-content>\\n \\n  <div #map id=\\\"map\\\" [hidden]=\\\"!user\\\"></div>\\n \\n  <div *ngIf=\\\"user\\\">\\n \\n    <ion-item>\\n      <ion-label>User ID: {{ user.uid }}</ion-label>\\n    </ion-item>\\n \\n\\n \\n    <ion-list>\\n      <ion-item-sliding *ngFor=\\\"let pos of locations | async\\\">\\n        <ion-item>\\n          <ion-label text-wrap>\\n            Lat: {{ pos.lat }}\\n            Lng: {{ pos.lng }}\\n            <p>\\n              {{ pos.timestamp | date:'short' }}\\n            </p>\\n          </ion-label>\\n        </ion-item>\\n \\n        <ion-item-options side=\\\"start\\\">\\n          <ion-item-option color=\\\"danger\\\" (click)=\\\"deleteLocation(pos)\\\">\\n            <ion-icon name=\\\"trash\\\" slot=\\\"icon-only\\\"></ion-icon>\\n          </ion-item-option>\\n        </ion-item-options>\\n \\n      </ion-item-sliding>\\n    </ion-list>\\n \\n  </div>\\n \\n</ion-content>\\n\"","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { GpsPage } from './gps.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: GpsPage\n  }\n];\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    RouterModule.forChild(routes)\n  ],\n  declarations: [GpsPage]\n})\nexport class GpsPageModule {}\n","export default \"#map {\\n  width: 100%;\\n  height: 300px;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9hcHAvZ3BzL0Q6XFxTRU04XFxwMy9zcmNcXGFwcFxcZ3BzXFxncHMucGFnZS5zY3NzIiwic3JjL2FwcC9ncHMvZ3BzLnBhZ2Uuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQTtFQUNJLFdBQUE7RUFDQSxhQUFBO0FDQUoiLCJmaWxlIjoic3JjL2FwcC9ncHMvZ3BzLnBhZ2Uuc2NzcyIsInNvdXJjZXNDb250ZW50IjpbIlxyXG4jbWFwe1xyXG4gICAgd2lkdGg6MTAwJTtcclxuICAgIGhlaWdodDogMzAwcHg7XHJcbn0iLCIjbWFwIHtcbiAgd2lkdGg6IDEwMCU7XG4gIGhlaWdodDogMzAwcHg7XG59Il19 */\"","import { Component, ViewChild, ElementRef } from '@angular/core';\nimport {Plugins, GeolocationPluginWeb} from '@capacitor/core';\nimport { AngularFireAuth } from '@angular/fire/auth';\nimport { Observable } from 'rxjs';\nimport {map} from 'rxjs/operators';\nimport { AngularFirestoreCollection, AngularFirestore } from '@angular/fire/firestore';\n\n\nconst {Geolocation} =Plugins;\n\n declare var google;\n\n@Component({\n  selector: 'app-gps',\n  templateUrl: 'gps.page.html',\n  styleUrls: ['gps.page.scss'],\n})\nexport class GpsPage {\n  locations:Observable<any>;\n  locationsCollection: AngularFirestoreCollection<any>;\n  user=null;\n\n  @ViewChild('map',{static:false}) mapElement:ElementRef;\n  map:any;\n  markers=[];\n  isTracking = false;\n  watch: string;\n  constructor(\n    private afAuth:AngularFireAuth,\n    private afs:AngularFirestore) {\n    this.anonLogin();\n  }\n\n  ionViewWillEnter(){\n    this.loadMap();\n  }\n  loadMap(){\n    let latlng=new google.maps.LatLng(51.9090902,7,6673267);\n\n    let mapOptions={\n      center:latlng,\n      zoom:5,\n      mapTypeId:google.maps.MapTypeId.ROADMAP\n    };\n    this.map=new google.maps.Map(this.mapElement.nativeElement,mapOptions);\n  }\n  \n  anonLogin(){\n    //email auth\n    this.afAuth.auth.signInAnonymously().then(user=>{\n      console.log(user);\n      this.user=user;\n    }).then(()=>{\n      this.findloc();\n    });\n  }\n\n\n  findloc(){\n      this.locationsCollection=this.afs.collection(\n        `locations/cleaner1/track`,\n        ref=>ref.orderBy('timestamp',\"desc\")\n      );\n      \n      this.locations = this.locationsCollection.snapshotChanges().pipe(\n        map(actions =>\n          actions.map(a => {\n            const data = a.payload.doc.data();\n            const id = a.payload.doc.id;\n            return { id, ...data };\n          })\n        )\n      );\n \n      this.locations.subscribe(locations => {\n        this.updateMap(locations);\n      });\n\n  }\n\n  // Delete a location from Firebase\n  deleteLocation(pos) {\n    this.locationsCollection.doc(pos.id).delete();\n\n  }\n   \n  // Redraw all markers on the map\n  updateMap(locations) {\n    // Remove all current marker\n    console.log(\"update called\",locations);\n    \n    this.markers.map(marker => marker.setMap(null));\n    this.markers = [];\n    // for (let loc of locations) {\n      let latLng = new google.maps.LatLng(locations[0].lat, locations[0].lng);\n      this.map.setCenter(latLng);\n      this.map.setZoom(14);\n\n      let marker = new google.maps.Marker({\n        map: this.map,\n        animation: google.maps.Animation.DROP,\n        position: latLng\n      });\n      this.markers.push(marker);\n\n      setTimeout(()=>{this.findloc();},10000);\n    // }\n  }\n}\n"],"sourceRoot":"webpack:///"}